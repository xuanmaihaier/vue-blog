(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{568:function(s,n,a){"use strict";a.r(n);var t=a(5),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"关于git-action的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于git-action的使用"}},[s._v("#")]),s._v(" 关于git action的使用")]),s._v(" "),a("p",[s._v("首先我理解的git action就是在git提交到仓库时帮你做一系列的操作，第一次接触到它时，是前公司使用的一个叫jenkens的插件，这个插件中，选择git分支会自动帮你构造测试环境部署到服务器，当时我就觉得特别神奇，已经自动化到这种程度了吗，后来我想到自己的博客vuepress，每次都需要重新打包，重新部署发布，这一套流程让我觉得写博客变得《不太实惠》，如果配合自动化，会不会变得很easy，后来网上看了看，确实是很多用vuepress配合自动化一起使用的，在push的时候，本地不需打包，git云端帮你打包并且将打包后的文件夹放到服务器的指定目录，配合nginx实现前端发布。")]),s._v(" "),a("p",[s._v("首先在git上选择了actions - set up a workflow yourself")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://stride.fun/public/uploads/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87%E7%BC%96%E8%BE%91_20220106091329.jpg",alt:"Image text"}})]),s._v(" "),a("p",[s._v("会让你写一个yml的文件 我的配置 大致如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('name: Build app and deploy to aliyun\non:\n  #监听push操作\n  push:\n    branches:\n      # master分支，你也可以改成其他分支\n      - master\njobs:\n  build:\n    # runs-on 指定job任务运行所需要的虚拟机环境(必填字段)\n    runs-on: ubuntu-latest\n    steps:\n      # 获取源码\n      - name: Checkout\n        # 使用action库  actions/checkout获取源码\n        uses: actions/checkout@master\n      # 安装yarn\n      - name: use yarn.js 1.22.10\n        # 使用action库  actions/setup-node安装yarn\n        uses: actions/setup-node@v1\n        with:\n          yarn-version: 1.22.10\n      # 安装依赖\n      - name: yarn install\n        run: yarn install\n        # 打包\n      - name: yarn build\n        run: yarn run build\n      # 部署到阿里云\n      - name: Deploy to Aliyun\n        uses: easingthemes/ssh-deploy@v2.1.1\n        env:\n          # 私钥\n          SSH_PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}\n          # scp参数\n          ARGS: "-avzr --delete"\n          # 源目录，编译后生成的文件目录\n          SOURCE: "./public"\n          # 服务器ip：换成你的服务器IP\n          REMOTE_HOST: "139.196.145.239"\n          # 用户\n          REMOTE_USER: "root"\n          # 目标地址 你在服务器上部署代码的地方\n          TARGET: "/www/blog"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("p",[s._v("因为我生成的是public文件夹不是dist，SOURCE是public，nginx配置一下地址就行了，需要注意的SSH_PRIVATE_KEY这个需要你在服务器配置一下ssh\n"),a("img",{attrs:{src:"https://stride.fun/public/uploads/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87%E7%BC%96%E8%BE%91_20220106092205.jpg",alt:"Image text"}})]),s._v(" "),a("p",[s._v("这个PRIVATE_KEY就是你设置的名字，value就是你的ssh 这个ssh通过以下步骤在服务器获得")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 以下在你的服务器上操作\n# 创建秘钥\nssh-keygen -m PEM -t rsa -b 4096\n# 在服务器上安装公钥\ncat .ssh/id_rsa.pub >> .ssh/authorized_keys\n# 编辑ssh config 目录在/etc/ssh/sshd_config配置以下两个属性\nRSAAuthentication yesPubkeyAuthentication yes\nPermitRootLogin yes\n# 重启服务器\nservice sshd restart\n# 复制 id_rsa(目录在/root/.ssh)里的密钥到git PRIVATE_KEY.value，我是用的宝塔，xftp权限不够看不见.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("注意不是在根目录生成的xxx.yml，是在.github/workflows/，我第一次不知道为什么生成在根目录，根本没有这个action，捣鼓了半天。如果有问题，在actions也能看到每次build出现的问题。其实过程中还有许多坑，遇到问题解决问题就完事了。")])])}),[],!1,null,null,null);n.default=e.exports}}]);