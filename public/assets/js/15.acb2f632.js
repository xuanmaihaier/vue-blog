(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{571:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("需求：实施在部署前后端时存在未取到最新包，且由于业务水平不同，可能会浪费大量时间，需要直观告诉实施当前的前端版本。")]),t._v(" "),a("p",[t._v("已知：前端版本关联git分支名，且项目走gitlab自动化，可以使用git拦截器插件结合webpack去做，但我觉得用插件好像太笨重了。")]),t._v(" "),a("p",[t._v("方法：可以利用yml自动化构建build后在打包后的html最后注入script脚本，以下为关键代码。")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 获取版本号赋值\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" export RELEASE=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_COMMIT_REF_NAME%_dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" export MOULD_NAME=test\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 增加meta 告知用户版本号")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' export VERSION_DIV="<script'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("var meta=document.createElement('meta');meta.name='$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOULD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("';meta.content='$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("RELEASE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("';if (document.getElementsByTagName('head')"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(") "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("document.getElementsByTagName('head')"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".appendChild(meta)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("</script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('"\n  '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' export VERSION_LOG="<script'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("console.log('%c $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOULD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" %c '.concat('$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("RELEASE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("' ')"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'background:#35495e;padding:1px;border-radius:3px 0 0 3px;color:#fff'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("'background"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#41b883;padding:1px;border-radius:0 3px 3px 0;color:#fff')<\/script>\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" frontend\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /^."),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*_dev$/")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /^."),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*_master$/")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//10.1.1.161"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4837")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("prod\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# index html插入对应script")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("VERSION_LOG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOULD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/index.html\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("VERSION_DIV"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOULD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/index.html\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" 一系列文件操作\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("p",[t._v("效果：\n"),a("img",{attrs:{src:"https://stride.fun/public/uploads/blog/ee026694930f4d6da7d61cd92fe48e5b.png",alt:"Image text"}}),t._v(" "),a("img",{attrs:{src:"https://stride.fun/public/uploads/blog/ffaa2f22318e40aab87bbbfafd9204ce.png",alt:"Image text"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);